---
title: Fast and differentiable likelihoods with Blast.jl
subtitle: Computing the 3x2 pt without the Limber approximation
format:
    clean-revealjs:
        footer: "Fast and differentiable likelihoods with Blast.jl"
        logo: "https://res.cloudinary.com/df9pocq2o/image/upload/v1747889986/Waterloo_Science_Logo_horiz_rgb_iliu71.png"
        include-in-header:
            - text: |
                <style>
                    /* shrink all slide text to 85% of the default */
                    .reveal .slides {
                    font-size: 0.85em !important;
                    }

                    }

                    .reveal .footer {
                    font-size: 0.8em !important;
                    }

                    /* if you want to tweak headings independently */
                    .reveal h1 { font-size: 1.6em !important; }
                    .reveal h2 { font-size: 1.3em !important; }

                    /* your existing logo rule */
                    .reveal .slide-logo {
                    max-height: 2.0em !important;
                    }
                </style>
html-math-method:
  method: mathjax
  url: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
author:
  - name: Marco Bonici
    orcid: 0000-0002-8430-126X
    email: marco.bonici@uwaterloo.ca
    affiliations: Waterloo Centre for Astrophysics
date: last-modified
institute: "3x2 pt meeting, Paris"
---

##

Computation of the $3\times2\,\mathrm{pt}$ is somewhat expensive
$$
C_{i j}^{\mathrm{AB}}(\ell)= \iint \chi_1 \mathrm{d} \chi_2 W_i^{\mathrm{A}}\left(\chi_1\right) W_j^{\mathrm{B}}\left(\chi_2\right) \int \mathrm{d} k k^2 P_{\mathrm{AB}}\left(k, \chi_1, \chi_2\right) \frac{j \ell\left(k \chi_1\right) j_{\ell}\left(k \chi_2\right)}{\left(k \chi_1\right)^\alpha\left(k \chi_2\right)^\beta}
$$

:::: {.columns}
::: {.column width="50%"}
Approximations:

- Limber Approximation
- Second Order Limber
:::

::: {.column width="50%"}
Dedicated codes and algorithms:

- FKEM
- Levin
- Matter
- Flat-sky
:::
::::

## An interlude: projection effects {}

:::: {.columns}
::: {.column width="60%"}
Well known in bayesian analysis: credibility intervals do not have coverage properties, unlike frequentist confidence intervals.

Marginalized 1D Bayesian intervals do not necessarily contain the MLE/MAP.

See also [Carrilho et al. 2022](https://arxiv.org/abs/2207.14784), [Hadzhiyska et al. 2023](https://arxiv.org/abs/2301.11895), [Holm et al. 2023](https://arxiv.org/abs/2309.04468).
:::

::: {.column width="40%"}
![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747794126/damico_bs_pe_it2lwl.png)
[D'Amico et al., 2022](https://arxiv.org/abs/2206.08327)
:::
::::

::: {.notes}
Speaker notes go here.
:::

## {auto-animate=true }

::: {style="font-size: 1.5em; color: royalblue;"}
Using tighter priors
:::
- Pro: use knowledge of galaxy-halo connection physics
- Con: as good as the galaxy-halo connection model employed

[Perform a frequentist analysis]{.fg style="font-size: 1.5em; --col: crimson;"}

- Pro: no prior at all
- Con: different statistical interpretation of the results

[Choose a better basis]{.fg style="font-size: 1.5em; --col: green;"}

- Pro: bayesian, does not require simulations
- Con: it does not satisfy the strong likelihood principle

## {auto-animate=true data-background-image="https://res.cloudinary.com/df9pocq2o/image/upload/v1747794126/bkg_anxyvx.png" data-background-size="cover" data-background-opacity="0.3"}

::: {style="font-size: 3em; color: royalblue;"}
Using tighter priors
:::
Based on ArXiv [2409.12937](https://arxiv.org/abs/2409.12937) and [2504.10407](https://arxiv.org/abs/2504.10407)

## { #HIP-recipe}

::: {style="font-size: 2em; color: royalblue;"}
A recipe to calibrate the EFT prior^[See also [Sullivan et al. 2021](https://arxiv.org/abs/2104.10676), [Zennaro et al. 2022](https://arxiv.org/abs/2110.05408), [Ivanov et al. 2024](https://arxiv.org/abs/2409.10609)]
:::

:::: {.columns}
::: {.column width="55%"}

::: {.fragment fragment-index=1}
- Populate DM-only simulations using an HOD prior
:::
::: {.fragment fragment-index=2}
- Compute EFT-bestfit for each combination of HOD and [cosmological parameters](#HIP-cosmology)
:::
::: {.fragment fragment-index=3}
- Filter points with a $P_{0,\mathrm{loop}}$ bigger than $P_{0,11}$ (perturbative prejudice)
:::

::: {.fragment fragment-index=4}
- Train a normalizing flow to be used as a prior
:::

:::

::: {.column width="45%"}
::: {.r-stack}
![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747857733/HOD_prior_srp9pq.png){.fragment width="450" height="200"  fragment-index=1}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747876436/perturbative_check_p4baiy.png){.fragment width="450" height="450" fragment-index=3}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747876512/prior_DESI_qjzv7w.png){.fragment width="450" height="450" fragment-index=4}
:::
:::
::::

## {auto-animate=true }

::: {style="font-size: 2.0em; color: royalblue;"}
Using tighter priors
:::

:::: {.columns}
::: {.column width="55%"}

::: {.fragment fragment-index="1"}
Narrower priors calibrated on HODs remove projection effects on PyBird
<span class="fragment" data-fragment-index="2">and velocileptors synthetic realizations</span>
<span class="fragment" data-fragment-index="3">and measurements from simulations with different galaxy-halo connection physics</span>
:::

::: {.fragment fragment-index=4}
Application to DESI data succesfully removed projection effects in $w_0 w_a$CDM cosmology!
:::

:::

::: {.column width="45%"}
::: {.r-stack}
![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747794127/wcdm_HIP_fit_inwfiz.png){.fragment .fade-in-then-out width="450" height="450"  fragment-index=1}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747879405/velocileptor_smooth_fzug6s.png){.fragment .fade-in-then-out width="450" height="450"  fragment-index=2}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747794127/sham_fit_szgifm.png){.fragment .fade-in-then-out width="450" height="450" fragment-index=3}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747796917/desi_HIP_1_ypepip.png){.fragment .fade-in-then-out width="450" height="450" fragment-index=4}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747879766/w0_wa_HIP_qqcgdv.png){.fragment width="450" height="370" fragment-index=5}
:::
:::
::::

## {auto-animate=true }

::: {style="font-size: 1.5em; color: royalblue;"}
Using tighter priors
:::
- Pro: use knowledge of galaxy-halo connection physics
- Con: as good as the galaxy-halo connection model employed

::: {style="font-size: 1.5em; color: crimson;"}
Perform a frequentist analysis
:::

- Pro: no prior at all
- Con: different statistical interpretation of the results

[Choose a better basis]{.fg style="font-size: 1.5em;--col: green;"}

- Pro: bayesian, does not required galaxy-halo connection physics
- Con: it does not satisfy the strong likelihood principle

## {auto-animate=true data-background-image="https://res.cloudinary.com/df9pocq2o/image/upload/v1747794126/bkg_anxyvx.png" data-background-size="cover" data-background-opacity="0.3"}

::: {style="margin-top: 100px; font-size: 2em; color: crimson;"}
Perform a frequentist analysis
:::

## {auto-animate=true }

::: {style="font-size: 1.5em; color: crimson;"}
Perform a frequentist analysis
:::

:::: {.columns}
::: {.column width="55%" .fragment fragment-index=1}
Rather than spending time calibrating a better prior, just get rid of that.

::: {.fragment fragment-index="2"}
Almost no projections in $\Lambda$CDM,
<span class="fragment" data-fragment-index="3">while significant ones in $w_0 w_a$CDM cosmology!</span>
<span class="fragment" data-fragment-index="4">Frequentist results are qualitatively compatible with the HIP ones.</span>
:::

:::

::: {.column width="45%" .fragment fragment-index=2}
::: {.r-stack}
![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747795899/LCDM_profiles_klectz.png){.fragment .fade-in-then-out fragment-index=2}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747798584/w0wacdm_profiles_ovvuoz.png){.fragment .fade-in-then-out width="450" height="450" fragment-index=3}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747795899/2D_profiles_dp6txt.png){.fragment .fade-in width="400" height="550"  fragment-index=4}
:::
:::
::::


## { #HIP-cosmology}

::: {style="font-size: 1.5em; color: royalblue;"}
[The HOD Informed Prior cosmological dependency](#HIP-recipe)
:::
:::: {.columns}
::: {.column width="55%"}

::: {.fragment fragment-index="1"}
A natural question about our methodology: is there any cosmological dependency within the HIP we have to take care of?
In order to study this issue, we used a suite of 30 Abacus simulations and populated them with an HOD
:::

::: {.fragment fragment-index=2}
Here we show the median and 68% of the EFT parameters for each considered cosmology. The cosmological dependency is mild but non-zero. We account for that by stacking all considered cosmologies together.
:::

:::

::: {.column width="45%"}
::: {.r-stack}
![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747877440/abacus_simulations_kjdlja.png){.fragment .fade-in-then-out width="450" height="450"  fragment-index=1}

![](https://res.cloudinary.com/df9pocq2o/image/upload/v1747877532/single_cosmology_prior_agmdwq.png){.fragment width="350" height="450" fragment-index=2}
:::
:::
::::
